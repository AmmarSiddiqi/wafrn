<mat-card class="wafrn-container p-3 lg:mx-4 overflow-hidden mb-6 blog-header">
  <div class="flex align-content-end justify-content-center header-image mb-2" [style.background-image]="'url('+ headerUrl + ')'">
    <img style="max-width: 100%; max-height: 15vh" [src]="avatarUrl" alt="user avatar"
      class="border-round-md mt-6 mb-4" />
  </div>

  <div class="flex justify-content-center flex-wrap">
    <p [innerHtml]="blogDetails.name" class="m-0 text-xl font-medium line-height-3"></p>
  </div>
  <div class="flex justify-content-center flex-wrap">
    <p [innerText]="blogDetails.url" class="m-0 text-sm line-height-3 blog-url"></p>
  </div>
  <hr class="w-full my-3">
  @if (userLoggedIn && !isMe) {
  <div *ngIf="userLoggedIn" class="flex gap-0 flex-nowrap mx-auto">
    <button mat-stroked-button [color]="
          postService.followedUserIds.indexOf(blogDetails.id) === -1 ? 'primary' : 'warn'
        " *ngIf="!postService.notYetAcceptedFollowedUsersIds.includes(blogDetails.id)" class="split-button-left"
      (mousedown)="
            postService.followedUserIds.indexOf(blogDetails.id) === -1
            ? followUser(blogDetails.id)
            : unfollowUser(blogDetails.id)
        ">
      {{ postService.followedUserIds.indexOf(blogDetails.id) === -1 ? "Follow" : "Unfollow" }}
    </button>
    <button mat-stroked-button color="accent"
      *ngIf="postService.notYetAcceptedFollowedUsersIds.includes(blogDetails.id) && userLoggedIn"
      class="split-button-left" (mousedown)="unfollowUser(blogDetails.id)">
      Awaiting approval
    </button>
    <button [matMenuTriggerFor]="menu" mat-stroked-button [color]="
          postService.followedUserIds.indexOf(blogDetails.id) === -1 ? 'primary' : 'warn'
        " class="split-button-right">
      <fa-icon [icon]="expandDownIcon"></fa-icon>
    </button>
  </div>

  <mat-menu #menu="matMenu" xPosition="before">
    @if(!blogDetails.muted){
    <button mat-menu-item (mousedown)="blockService.muteUser(this.blogDetails.id)">
      <fa-icon class="mr-2" [icon]="muteUserIcon"></fa-icon>Mute user
    </button>
    } @else {
    <button (mousedown)="blockService.unmuteUser(this.blogDetails.id)" mat-menu-item>
      <fa-icon class="mr-2" [icon]="unmuteUserIcon"></fa-icon>Unmute user
    </button>
    } @if(!blogDetails.blocked) {
    <button mat-menu-item (mousedown)="blockService.blockUser(this.blogDetails.id)">
      <fa-icon class="mr-2" [icon]="blockUserIcon"></fa-icon>Block user
    </button>
    } @else {
    <button mat-menu-item (mousedown)="blockService.unblockUser(this.blogDetails.id)">
      <fa-icon class="mr-2" [icon]="userIcon"></fa-icon>Unblock user
    </button>
    } @if(blogDetails.url.startsWith('@')) { @if( !blogDetails.serverBlocked) {
    <button mat-menu-item (mousedown)="blockService.blockServer(this.blogDetails.id)">
      <fa-icon class="mr-2" [icon]="unblockServerIcon"></fa-icon>Block server
    </button>
    } @else {
    <button *ngIf="blogDetails.federatedHost" mat-menu-item
      (mousedown)="blockService.unblockServer(this.blogDetails.federatedHost.id)">
      <fa-icon class="mr-2" [icon]="unblockServerIcon"></fa-icon>Unblock server
    </button>
    } }
  </mat-menu>
  }
  <div class="mt-3 mb-2">
    <div style="word-wrap: anywhere" [innerHtml]="blogDetails.description"></div>
  </div>
  @if (fediAttachment.length !== 0) {
  <hr class="w-full my-3">
  <div class="w-full overflow-hidden flex flex-column gap-2">
    <p>Fediverse Attachments</p>
    <dl *ngFor="let fediAt of fediAttachment" class="flex m-0">
      <dt [innerHTML]="fediAt.name" class="w-3"></dt>
      <dd [innerHTML]="fediAt.value" class="w-8 ml-2"></dd>
    </dl>
  </div>
  }
  @if (allowAsk) {

  <div class="flex justify-content-center flex-wrap">
    <button mat-stroked-button [innerHTML]="'Ask ' +blogDetails.name + ' something'"
      (mousedown)="openAskDialog()"></button>
  </div>
  }
  @if (!blogDetails.url.startsWith('@') || (blogDetails.followers && blogDetails.followed)) {
  <hr class="w-full my-3">
  <div class="flex justify-content-evenly follow-counts">
    <a [routerLink]="['/blog', blogDetails.url ,'following']" class="flex flex-column justify-content-center">
      <b class="m-0 text-lg text-center">{{ blogDetails.followed }}</b>
      <p class="m-0 text-xs">Following</p>
    </a>
    <a [routerLink]="['/blog', blogDetails.url ,'followers']" class="flex flex-column justify-content-center">
      <b class="m-0 text-lg text-center">{{ blogDetails.followers }}</b>
      <p class="m-0 text-xs">Followers</p>
    </a>
  </div>
  }
  <div *ngIf="allowRemoteAsk" class="justify-content-center">
    <p class="m-0">
      You can send this user a non-anonymous ask from your fedi instance with
      the following structure: " !ask &#64;{{ blogDetails.url }} YOUR QUESTION
      HERE". The medias and emojis you attach will be ignored, and you can only
      send one mention on the post. If it goes wrong, the user will receive it
      as a regular DM. Also, the content of the DM will be published as the AP
      object to verify the ask as genuine
    </p>
  </div>
</mat-card>
<app-info-card
  [type]="infoAlert"
  class="block p-4 pt-3 pb-6 wafrn-container notification"
  *ngIf="blogDetails.url.startsWith('@')"
  >As this user is from a remote instance, the shown information may be
  incomplete.
  <a [href]="blogDetails.url.split('@').length == 3 ? blogDetails.remoteId : ('https://bsky.app/profile/' + blogDetails.url.split('@')[1])" target="_blank"
    >View on remote instance</a
  >
</app-info-card>
